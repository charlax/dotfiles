#!/bin/bash

. "$(dirname "$0")/../helpers/setup.sh"


if [[ "$OSTYPE" =~ ^darwin ]]; then

    printf "\n\n${GREEN}Updating brew packages${NC}\n"

    ssh-add -A
    brew update
    # NOTE: when using pinned packages, brew upgrade fails
    brew upgrade  || true
    brew cleanup
    brew cask upgrade
    brew doctor || true
    brew cask doctor || true

fi

if [[ "$OSTYPE" == "linux-gnu" ]]; then
    printf "\n\n${GREEN}Updating apt packages${NC}\n"

    apt-get update
    apt-get upgrade -y
fi

echo "Done."

printf "\n\n${GREEN}Updating pip${NC}\n"
pip3 install --user --upgrade pip

printf "\n\n${GREEN}Updating pipx${NC}\n"
python3 -m pip install -U pipx

printf "\n\n${GREEN}Updating all pipx apps${NC}\n"
pipx upgrade-all

# TODO: migrate to pipx

# echo "Installing/updating pipenv"
# pip3 install --user --upgrade pipenv

# echo "Installing/updating black (Python code formatter)"
# pip3 install --user black

# echo "Installing/updating awscli"
# pip3 install --user --upgrade awscli

# echo "Installing/updating ipython"
# pip3 install --user --upgrade ipython

echo "Updating Vim dotfiles"
$VIM_DOTFILES/update-plugins.sh

if command -v npm >/dev/null 2>&1; then
    printf "\n\n${GREEN}Updating npm${NC}\n"
    npm install npm@latest -g
fi

printf "\n\n${GREEN}Updating tldr.${NC}\n"
tldr --update

printf "\n\n${GREEN}Updating done.${NC}\n"
