#!/usr/bin/env python3
"""Archive a file by moving it to an Archive subdirectory."""

import argparse
import sys
from pathlib import Path


def main():
    parser = argparse.ArgumentParser(
        description="Archive a file by moving it to an Archive subdirectory"
    )
    parser.add_argument(
        "-n",
        "--dry-run",
        action="store_true",
        help="Show what would be done without moving the file",
    )
    parser.add_argument("filename", help="File to archive")

    args = parser.parse_args()

    file_path = Path(args.filename)

    # Check if file exists and is a regular file
    if not file_path.exists():
        print(f"Error: {args.filename} not found.", file=sys.stderr)
        sys.exit(2)

    if not file_path.is_file():
        print(
            f"Error: {args.filename} is not a regular file.",
            file=sys.stderr,
        )
        sys.exit(2)

    # Determine archive directory location
    # If file has a directory path, use Archive folder there
    # Otherwise use Archive in current directory
    file_dir = file_path.parent
    archive_dir = file_dir / "Archive"

    # Create archive directory if it does not exist
    if not archive_dir.exists():
        if args.dry_run:
            print(f"[DRY RUN] Would create directory: {archive_dir}")
        else:
            archive_dir.mkdir(parents=True, exist_ok=True)

    # Check if target file already exists in Archive directory
    target_path = archive_dir / file_path.name
    if target_path.exists():
        print(
            f"Error: {file_path.name} already exists in {archive_dir} directory.",
            file=sys.stderr,
        )
        sys.exit(3)

    # Move the file
    if args.dry_run:
        print(f"[DRY RUN] Would move: {file_path} -> {target_path}")
    else:
        file_path.rename(target_path)
        print(f"Moved {file_path} to {archive_dir}/")


if __name__ == "__main__":
    main()
