#!/usr/bin/env python3

import argparse
import glob
import os
import subprocess

DIRECTORIES = ("~/Downloads", "~/Desktop")


def listdir_nohidden(path):
    return glob.glob(os.path.join(path, "*"))


def run(cmd):
    print(cmd)
    subprocess.run(cmd, shell=True, check=True)


def run_maintenance_tasks():
    print("\nRunning maintenance tasks")
    run("sudo periodic daily weekly monthly")


def clean_up_ruby():
    print("\nCleaning up ruby")
    run("gem cleanup")


def clean_up_docker():
    print("\nCleaning up Docker")
    run("docker system prune -af")


def main(is_dry_run: bool) -> None:
    directories = map(os.path.expanduser, DIRECTORIES)

    if is_dry_run:
        print("\nWould have removed:")

    for d in directories:
        if not listdir_nohidden(d):
            print(f"{d} is already empty")
            continue

        print(d)
        for f in listdir_nohidden(d):
            print(f"  {f}")

        if is_dry_run:
            continue

        run(f"rmtrash {d}/*")

    run_maintenance_tasks()
    clean_up_ruby()
    clean_up_docker()


if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Delete Downloads and Desktop folders")
    parser.add_argument(
        "--dry-run", action="store_true", help="do not actually delete anything"
    )

    args = parser.parse_args()

    main(is_dry_run=args.dry_run)
